package PhotoListener;

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.util.Date;

import javax.imageio.ImageIO;

import android.media.ExifInterface;

import com.drew.imaging.ImageMetadataReader;
import com.drew.imaging.ImageProcessingException;
import com.drew.lang.GeoLocation;
import com.drew.metadata.Metadata;
import com.drew.metadata.MetadataException;
import com.drew.metadata.exif.ExifSubIFDDirectory;
import com.drew.metadata.exif.GpsDirectory;
import com.drew.metadata.jpeg.JpegDirectory;

import Common.Photo;
import Common.Point;

public class PhotoListenerThread {

	public PhotoListenerThread() {
	}

	public Photo createPhotoFromFile(File path) {

		ExifInterface exif = new ExifInterface(path.getPath());

		//get location
		float coordinate[];
		boolean res = exif.getLatLong(coordinate);
		if (!res) {
			// TODO: write to log
		}

		//get time
		String timeString = exif.getAttribute(ExifInterface.TAG_DATETIME);

		Photo photo = null;

		//get dimensions
		int width = exif.getAttributeInt(ExifInterface.TAG_IMAGE_WIDTH, 0);
		int	height = jpgDirectory.getImageHeight();
		if (width == 0 || height == 0) {
			//TODO: something
		}
		
		try {
			

			photo = new Photo(
					date,
					width,
					height,
					new Point(location.getLongitude(),location.getLatitude()),
					true,
					path.getPath());
		} catch (MetadataException e) {
			// TODO ERROR reading EXIF details of photo
			e.printStackTrace();
		}

		return photo;
	}

	/**
	 * use EXIFInterface from android to decide orientation
	 * @param width
	 * @param height
	 * @return
	 */
	// TODO: implement
	private static boolean isHorizontal(int width, int height) {
		return false;

	}
}
